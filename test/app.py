import streamlit as st
from lastmodel import predict_unfairness, get_similar_clauses, generate_explanation

def main():
    st.set_page_config(
        page_title="ì•½ê´€ ì¡°í•­ ë¶ˆê³µì •ì„± ê²€ì‚¬",
        page_icon="ğŸ“ƒ",
        layout="wide"
    )

    st.title("ğŸ” ì•½ê´€ ì¡°í•­ ë¶ˆê³µì •ì„± ê²€ì‚¬ê¸°")
    st.markdown(
        """
        ì•„ë˜ í…ìŠ¤íŠ¸ ë°•ìŠ¤ì— ì—¬ëŸ¬ ì•½ê´€ ì¡°í•­ì„ í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥í•˜ì„¸ìš”.  
        ë¹ˆ ì¤„ì„ ì…ë ¥í•˜ê±°ë‚˜ 'ê²€ì‚¬ ì‹œì‘' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, ê° ì¡°í•­ì´ ë¶ˆê³µì •í•œì§€ ì—¬ë¶€ë¥¼ íŒë³„í•˜ê³   
        ë¶ˆê³µì • ì¡°í•­ì¸ ê²½ìš° ìœ ì‚¬ ì¡°í•­ ì˜ˆì‹œì™€ í•¨ê»˜ í•œêµ­ì–´ ì„¤ëª…ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
        """
    )

    # ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ì¤„ë¡œ ì…ë ¥í•  ìˆ˜ ìˆë„ë¡ text_area ì‚¬ìš©
    input_text = st.text_area(
        label="ğŸ“¥ ì—¬ëŸ¬ ì•½ê´€ ì¡°í•­ì„ ì…ë ¥í•˜ì„¸ìš” (í•œ ì¤„ì— í•˜ë‚˜ì˜ ì¡°í•­)",
        placeholder="ì˜ˆì‹œ:\nì œ1ì¡° ì´ ê³„ì•½ì€ â€¦\nì œ2ì¡° ê³„ì•½ í•´ì§€ ì‹œ â€¦\nâ€¦",
        height=200
    )

    # ì…ë ¥ëœ í…ìŠ¤íŠ¸ë¥¼ ì¤„ ë‹¨ìœ„ë¡œ ìª¼ê°œê³ , ë¹ˆ ì¤„ì€ ë¬´ì‹œ
    clauses = [line.strip() for line in input_text.split("\n") if line.strip() != ""]

    # ê²€ì‚¬ ì‹œì‘ ë²„íŠ¼
    if st.button("ê²€ì‚¬ ì‹œì‘"):
        if not clauses:
            st.warning("ğŸ”¸ ì•½ê´€ ì¡°í•­ì„ í•œ ì¤„ì”© ì…ë ¥í•œ ë’¤, ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.")
            return

        with st.spinner("âœ… ì•½ê´€ ì¡°í•­ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."):
            # 1) ê° ì¡°í•­ì— ëŒ€í•´ ë¶ˆê³µì • ì—¬ë¶€ë¥¼ ì˜ˆì¸¡
            labels = predict_unfairness(clauses)

            # 2) ê²°ê³¼ë¥¼ í˜ì´ì§€ì— ìˆœì„œëŒ€ë¡œ ì¶œë ¥
            for clause, label in zip(clauses, labels):
                st.markdown("---")
                st.write(f"**ì¡°í•­:** {clause}")

                if label == 1:
                    # ë¶ˆê³µì • ì¡°í•­ì¼ ê²½ìš°, ìœ ì‚¬ ì¡°í•­ + ì„¤ëª…ì„ ìƒì„±
                    similar = get_similar_clauses(clause, top_k=5)
                    explanation = generate_explanation(clause, similar)

                    st.error("âš ï¸ ë¶ˆê³µì • ì¡°í•­ìœ¼ë¡œ íŒë‹¨ë¨")
                    st.write("**ìœ ì‚¬ ì¡°í•­ ì˜ˆì‹œ:**")
                    for i, s in enumerate(similar, 1):
                        st.write(f"{i}. {s}")
                    st.write("**ì„¤ëª…:**")
                    st.write(explanation)

                else:
                    # ê³µì • ì¡°í•­ì¸ ê²½ìš°
                    st.success("âœ… ê³µì •(ìœ ë¦¬)í•œ ì¡°í•­ìœ¼ë¡œ íŒë‹¨ë¨")

    # ì‚¬ì´ë“œë°”ì— ê°„ë‹¨í•œ ì‚¬ìš©ë²• ì¶”ê°€
    with st.sidebar:
        st.header("â„¹ï¸ ì‚¬ìš©ë²•")
        st.markdown(
            """
            1. â€˜ğŸ“¥ ì—¬ëŸ¬ ì•½ê´€ ì¡°í•­ì„ ì…ë ¥í•˜ì„¸ìš”â€™ ì¹¸ì—  
               í•œ ì¤„ì— í•˜ë‚˜ì”© ì•½ê´€ ì¡°í•­ì„ ì…ë ¥í•©ë‹ˆë‹¤.  
            2. ì…ë ¥ì„ ë§ˆì¹œ ë’¤, â€˜ê²€ì‚¬ ì‹œì‘â€™ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê²°ê³¼ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.  
            3. ë¶ˆê³µì • ì¡°í•­ìœ¼ë¡œ íŒë‹¨ëœ ê²½ìš°,  
               ìœ ì‚¬ ì¡°í•­ ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            """
        )

if __name__ == "__main__":
    main()
